---
emoji:
title: Layer 2 blockchain
date: '2023-04-09 03:00:00'
author: inu
tags: blockchain L2 Layer 2 plasma polygon
categories: blockchain 
---
## Layer 2 blockchain

기존 레이어1 의 트랜잭션 fee 및 속도 문제를 최적화 하기 위해 `off-chain`으로 작동하는 또다른 계층. 레이어1의 합의 알고리즘과 보안시스템에 의존하기 때문에 레이어1에서 독립적으로 수행할 수 있음.

1.state channel
모든 state을 on-chain상에 기록하지 않고, off-chain 상의 별도의 state machine을 스마트 컨트랙트로 정의함. 이 off-chain 상에서 gas fee없이 state 변경이 일어나고, 시작 state과 최종 state만을 blockchain에 기록하고 해당 변경에 대해서 트랜잭션이 일어남.(예를 들어 게임)
payment channel이라고 하기도 함. 예를 들어 월초에 스마트 컨트랙트를 실행하여 payment channel을 열고, 한 달 동안의 요금 집계를 거쳐 월말에 payment channel을 닫은 뒤 요금만큼을 ETH 트랜잭션으로 정산.
state channel의 시작과 끝을 제외한 중간 변경 사항은 private, 혹은 스마트 컨트랙트 당사자만 아는 `off-chain`이기 때문에 프라이버시의 장점도 있음.
다만 이는 state channel 당사자들 사이의 신뢰 trust가 담보되어야 하는, 블록체인의 untrusted와는 다른 성질을 가짐. 당사자들이 state channel을 열고 닫을 때, 함께 available 해야 하기 때문. (중간에 나가지 않아야 함) 따라서 스마트 컨트랙트상에 담보 장치 등을 사용.

### 사이드 체인
사이드 체인은 레이어1에 채널로 연결되어 있지만, 별도의 합의알고리즘과 검증을 통해 병렬적으로 실행되는 별도 체인. 트랜잭션을 빠르게 수행하여 레이어1에 전달하는 등.

### 롤업
롤업은 레이어2에서 트랜잭션을 실행한뒤 이를 묶음, 압축하여 레이어1에 쓰는 것을 말함. 일반적인 레이어2 트랜잭션은 중간 트랜잭션을 모두 `off-chain`을 돌려서, 상태 검증 등을 생략하고 `trusted` 환경, 신뢰가 담보된 환경에서 실행한 뒤 시작과 끝 상태만을 기록하는 것. 반면 롤업은 레이어2에서 실행한 트랜잭션을 모두 '묶어서' 이를 레이어1에서 '한번에' 검증. 즉 `untrusted`로 작동 가능. 온체인 상에서 레이어2로 옮긴 데이터 만큼의 공간이 확보되기 때문에, 롤업 트랜잭션을 더 수월하게 검증할 수 있음. 데이터 베이스의 트랜잭션과 유사.
레이어1 상에 롤업 검증 및 실행하기 위한 스마트 컨트랙트 묶음을 배포함.

두가지 분류
1. 낙관적 롤업
   롤업에 대해 기본적으로 `유효하다` 고 가정하고 특정 기간 텀을 두고 레이어1의 노드가 이의제기 `challenge`를 할 수 있도록 함. 이 기간 동안 누군가 이의를 제기하면 레이어1에서 검증함. 이의제기 하지 않으면 그대로 받아들여짐.
   롤업 트랜잭션에 대한 검증은 세가지 플레이어가 있음
    1) asserter - 롤업을 체인상에 기록하려는, 롤업 실행자
    2) challenger - 롤업에 대해 이의를 제기한 유저
    3) verifier - 롤업을 실제로 검증하는 스마트 컨트랙트
       asserter와 challenger가 모두 일정 ETH를 담보한 뒤, 롤업을 검증했을 때 유효하면 challenger의 담보금을 asserter와 verifier가 나눠가짐. 유효하지 않으면 asserter의 담보금을 challenger와 verifier가 나눠가짐
2. ZK(`Zero-Knowledge`) 롤업
   영지식 증명이라는 암호학의 프로토콜을 사용해서 롤업 실행자(증명자)가 검증자(레이어1의 검증 스마트 컨트랙트)에게 롤업 트랜잭션의 어떠한 세부사항도 노출하지 않은채 그것이 유효하다는 것을 증명함. 따라서 이의제기를 하는 challenger 역할이 필요없고, 레이어1에 롤업을 쓸 시에 바로 유효한지 판단해서 이를 취소하거나 승인함. 문제는, ZK 증명을 실제로 만들어내는 것이 어렵고 모든 롤업마다 암호학적 증명을 찾아내야 함. 롤업 사이즈가 커질 수록 더 어려워지고 증명비용이 더 높아짐. 증명에 필요한 연산이 많아져서 스마트 컨트랙트의 크기를 넘기면 검증 불가.

지금까지는 `트랜잭션 실행`에 대한 여러가지 솔루션과 트레이트오프에 대해서 얘기했다. 그렇다면 데이터 `availability` 에 대한 솔루션을 알아보자.

### 플라스마 프레임워크

스케일러블한 레이어2 앱을 위한 프레임워크.
사이드체인 처럼  자체 합의 알고리즘을 가지고 블럭을 생성하며, 이를 머클 트리 해싱으로 레이어1 체인에 해시를 추가함 (주기적). 따라서 아무리 많은 수의 트랜잭션 / 블럭을 생성하더라도 압축된 하나의 블럭해시로 부모 블럭에 전달할 수 있어 매우 효율적. 레이어1과 상태를 커밋하기 위해서/ 혹은 레이어2 진입/ 종료를 위해서만 통신함.
낙관적 롤업 방식처럼 이의제기 방식을 사용하고, 자체 토큰 으로 ETH를 래핑한 wETH를 사용하기 때문에, 금액 이체에 시일이 걸리는 단점있음 . 토큰을 wETH로 교환하는 오버헤드 / 낙관적 롤업에 따른 의무 대기 기간.
플라즈마 프레임워크는 레이어1에 트랜잭션을 그대로 보내지 않고 해시된 머클 트리만을 보내기 때문에, 데이터가 오프체인에 저장되어있고, 이의제기 시에만 오프체인 데이터를 레이어1 체인과 상호작용함. 이의제기가 없다면 해시 스냅샷만을 보냄.

### Validium

레이어2의 data availability 유형으로 ZK Rollup이지만 데이터를 오프체인에 저장함. 따라서 유저가 데이터가 필요할 때 레이어2 참여자가 이를 제공할 것이라는 `trust`가 필요하며, 이를 위해 신뢰성있는 데이터 제공을 할 수 있다는 비즈니스 평판을 담보로 하는 위원회를 구성하고, 레이어2 노드가 요청에 응답하지 않으면 위원회가 해당 데이터의 사본을 공개함.

### Volition

Volition 체인은 Validium과 Rollup의 하이브리드 체인이다. Validium처럼 데이터를 오프체인에 저장하지만 유저가 온체인에 데이터를 가져올 시점을 정할 수 있다. 예를 들어, 일주일 단위의 전체 거래액의 손실 / 이익 만을 온체인에 저장하고 나머지개별 트랜잭션은 오프 체인에 저장하는 식이다.

ETH의 업그레이드와 함께, 기존의 하나의 단일 상태 네트워크를 여러 데이터셋으로 샤딩된 분산 네트워크로 변경하는 조치가 실행됐다. 이는, 기존에 단일 상태 네트워크에서 트랜잭션에 대한 수요가 높을 경우 가스 비용이 급등할 수 있었던 것을 보완하기 위한 조치로, 데이터를 온체인에 저장하는 비용을 줄이고 더 쉽게 만들기 위함이다.

롤업 등의 레이어2 솔루션은 기본적으로 오프체인에서 트랜잭션을 실행하는 대신 암호학적 트랜잭션 증명을 다시 메인(레이어1) 체인에 제공함으로써 레이어1의 보안 혜택을 그대로 사용하면서 가스 비용을 줄일 수 있었다. 이번 ETH 업그레이드는, 이러한 트랜잭션 증명과 레이어1과의 통신비용 또한 대폭 낮추는 효과가 있으므로 레이어2 솔루션은 기존보다 더 낮은 비용을 제공할 수 있게 되었다. 즉 ETH 업그레이드로 인해 레이어2도 동반 혜택을 볼 것으로 기대된다.


```toc
```